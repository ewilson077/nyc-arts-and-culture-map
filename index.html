<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NYC Arts and Culture Guide</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 90vh;
            width: 100%;
        }
    </style>
</head>
<body>
    <h3 align="center"><b>NYC Arts and Culture Guide</b></h3>
    <div id="map"></div>

    <!-- Leaflet core -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>

    <!-- Wicket for WKT parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wicket/1.3.4/wicket.min.js"></script>

    <!-- PapaParse for robust CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Custom map code -->
    <script>
        // Create map
        var map = L.map('map').setView([40.75, -73.97], 11);

        // Base tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // 1Ô∏è‚É£ Borough boundaries
        var boroughsLayer = new L.GeoJSON.AJAX("./data/Borough Boundaries.geojson", {
            style: { color: "blue", weight: 2 }
        }).addTo(map);

        // Function to load and plot CSV points
        function loadCsvPoints(url, iconEmoji) {
            fetch(url)
                .then(res => res.text())
                .then(text => {
                    Papa.parse(text, {
                        header: false,
                        skipEmptyLines: true,
                        complete: function(results) {
                            results.data.forEach(cols => {
                                if (cols.length < 5) return; // skip bad rows

                                const geom = cols[cols.length - 1];
                                const name = cols[0];
                                const address = cols[1];
                                const borough = cols[2];
                                const type = cols[3];
                                const urlReport = cols[4];

                                try {
                                    const wkt = new Wkt.Wkt();
                                    wkt.read(geom);
                                    const latLng = wkt.toObject().getBounds().getCenter();

                                    L.marker([latLng.lat, latLng.lng])
                                        .addTo(map)
                                        .bindPopup(`${iconEmoji} <strong>${name}</strong><br>${address}<br>Borough: ${borough}<br>Type: ${type}<br><a href="${urlReport}" target="_blank">More Info</a>`);
                                } catch (err) {
                                    console.error("Invalid WKT for:", name, err);
                                }
                            });
                        }
                    });
                });
        }

        // 2Ô∏è‚É£ Load landmarks
        loadCsvPoints("./data/landmarks.csv", "üèõ");

        // 3Ô∏è‚É£ Load museums
        loadCsvPoints("./data/museums.csv", "üñº");

        // 4Ô∏è‚É£ Load galleries
        loadCsvPoints("./data/galleries.csv", "üé®");

    </script>
</body>
</html>
 
