<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NYC Arts and Culture Guide</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        h3 {
            margin: 0;
            padding: 10px;
            text-align: center;
            background-color: #f4f4f4;
        }
        #map {
            height: 90vh;
            width: 100%;
        }
    </style>
</head>
<body>
    <h3><b>NYC Arts and Culture Guide</b></h3>
    <div id="map"></div>

    <!-- Leaflet core -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>

    <!-- Wicket -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wicket/1.3.4/wicket.min.js"></script>

    <script>
        // Create map
        var map = L.map('map').setView([40.75, -73.97], 11);

        // Base map layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Borough boundaries with original styling
        var boroughsLayer = new L.GeoJSON.AJAX("./data/Borough Boundaries.geojson", {
            style: function (feature) {
                return {
                    color: "#2b8cbe",
                    weight: 2,
                    fillColor: "#a6bddb",
                    fillOpacity: 0.2
                };
            }
        }).addTo(map);

        // Function to load CSV and plot points
        function loadCsvPoints(url, iconEmoji, color) {
            fetch(url)
                .then(res => res.text())
                .then(text => {
                    var rows = text.split("\n").slice(1); // Skip header row
                    rows.forEach(row => {
                        if (!row.trim()) return; // Skip empty rows
                        var cols = row.split(",");

                        // Ensure we have enough columns
                        if (cols.length < 5) return;

                        var name = cols[0];
                        var address = cols[1];
                        var borough = cols[2];
                        var type = cols[3];
                        var urlReport = cols[4];
                        var geom = cols[cols.length - 1]; // WKT geometry

                        try {
                            var wkt = new Wkt.Wkt();
                            wkt.read(geom);
                            var obj = wkt.toObject();

                            // Get center coordinates if polygon, or coordinates if point
                            var latLng;
                            if (obj.getBounds) {
                                latLng = obj.getBounds().getCenter();
                            } else {
                                latLng = obj.getLatLng();
                            }

                            // Add marker
                            L.circleMarker([latLng.lat, latLng.lng], {
                                radius: 6,
                                color: color,
                                fillColor: color,
                                fillOpacity: 0.8
                            })
                            .addTo(map)
                            .bindPopup(`${iconEmoji} <strong>${name}</strong><br>${address}<br>Borough: ${borough}<br>Type: ${type}<br><a href="${urlReport}" target="_blank">More Info</a>`);

                        } catch (err) {
                            console.error("Invalid WKT for:", name, err);
                        }
                    });
                });
        }

        // Load datasets
        loadCsvPoints("./data/landmarks.csv", "ğŸ›", "red");
        loadCsvPoints("./data/museums.csv", "ğŸ–¼", "green");
        loadCsvPoints("./data/galleries.csv", "ğŸ¨", "purple");

    </script>
</body>
</html>
